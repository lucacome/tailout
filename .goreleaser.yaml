version: 2
builds:
  - env:
      - CGO_ENABLED=0
    goos:
      - darwin
      - freebsd
      - linux
      # - solaris
      - windows
    goarch:
      - 386
      - amd64
      - arm
      - arm64
      - mips64
      - mips64le
      - ppc64
      - ppc64le
      - riscv64
      - s390x
    goarm:
      - 5
      - 6
      - 7
    gomips:
      - softfloat
    ignore:
      - goos: windows
        goarch: arm
    flags:
      - -trimpath
    binary: tailout

archives:
  - format_overrides:
      - goos: windows
        formats: ['zip']

sboms:
  - artifacts: archive
    args:
      - scan
      - "--enrich=all"
      - "$artifact"
      - "--output"
      - "spdx-json=$document"
    documents:
      - "${artifact}.spdx.json"

changelog:
  disable: true

signs:
  - cmd: cosign
    artifacts: checksum
    output: true
    certificate: "${artifact}.pem"
    args:
      - sign-blob
      - "--output-signature=${signature}"
      - "--output-certificate=${certificate}"
      - "${artifact}"
      - "--yes"

homebrew_casks:
  - repository:
      owner: lucacome
      name: homebrew-tap
    description: "Spawn an exit node for your tailnet anywhere with Tailout"
    homepage: "https://github.com/lucacome/tailout"
    license: "Apache-2.0, MIT"
    hooks:
      post:
        install: |
          if OS.mac?
            system_command "/usr/bin/xattr", args: ["-dr", "com.apple.quarantine", "#{staged_path}/tailout"]
          end
